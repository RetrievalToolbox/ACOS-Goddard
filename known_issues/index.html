<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Known Issues · ACOS Goddard</title><meta name="title" content="Known Issues · ACOS Goddard"/><meta property="og:title" content="Known Issues · ACOS Goddard"/><meta property="twitter:title" content="Known Issues · ACOS Goddard"/><meta name="description" content="Documentation for ACOS Goddard."/><meta property="og:description" content="Documentation for ACOS Goddard."/><meta property="twitter:description" content="Documentation for ACOS Goddard."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ACOS Goddard</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Main</a></li><li><a class="tocitem" href="../important/">Important</a></li><li class="is-active"><a class="tocitem" href>Known Issues</a><ul class="internal"><li><a class="tocitem" href="#Memory-use-due-to-Low-Streams-Interpolation-(LSI)"><span>Memory use due to Low-Streams Interpolation (LSI)</span></a></li><li><a class="tocitem" href="#Non-linearity-and-divergent-steps"><span>Non-linearity and divergent steps</span></a></li><li><a class="tocitem" href="#FootprintGeometry-not-used"><span>FootprintGeometry not used</span></a></li><li><a class="tocitem" href="#No-consideration-for-off-pointing-between-spectrometers"><span>No consideration for off-pointing between spectrometers</span></a></li><li><a class="tocitem" href="#Surface-pressure-Jacobian"><span>Surface pressure Jacobian</span></a></li><li><a class="tocitem" href="#BRDF-parameters"><span>BRDF parameters</span></a></li><li><a class="tocitem" href="#No-spectral-dependence-of-scattering-phase-function"><span>No spectral dependence of scattering phase function</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Known Issues</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Known Issues</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Known-Issues"><a class="docs-heading-anchor" href="#Known-Issues">Known Issues</a><a id="Known-Issues-1"></a><a class="docs-heading-anchor-permalink" href="#Known-Issues" title="Permalink"></a></h1><p>This page lists the currently known issues with this ACOS implementation - these are items that could be changed or fixed in the future. Users should be aware of them when making comparisons to results from ACOS retrievals.</p><h2 id="Memory-use-due-to-Low-Streams-Interpolation-(LSI)"><a class="docs-heading-anchor" href="#Memory-use-due-to-Low-Streams-Interpolation-(LSI)">Memory use due to Low-Streams Interpolation (LSI)</a><a id="Memory-use-due-to-Low-Streams-Interpolation-(LSI)-1"></a><a class="docs-heading-anchor-permalink" href="#Memory-use-due-to-Low-Streams-Interpolation-(LSI)" title="Permalink"></a></h2><p>The current version uses a large amount of memory when the retrieval is run with low-streams interpolation to include high-accuracy multiple scattering, including polarization. Peak memory usage is ~7GB when one process is used. This is a result of how the additional instances of the radiative transfer objects are spawned.</p><p>The ACOS algorithm as used with OCO-2/3 measurements requires a total of 4 different RT solver modes: a vector single-scattering one, a scalar two-stream one, a vector two orders of scattering (2OS) one, and a scalar discrete ordinate one for an arbitrary number of streams. During the &quot;binned&quot; calculations in which we perform the RT for representative profiles, these four solver modes have to be spawned for every bin. This produces significant overhead in terms of memory. For now, we have chosen to keep the current solution as to not sacrifice legibility for a lower memory footprint. Future versions of RetrievalToolbox or ACOS-Goddard might change this.</p><p>For benchmarking purposes, the memory footprint can be lowered by omitting LSI (<code>--LSI false</code>), disabling polarization (<code>--polarized false</code>) or disabling aerosols (<code>--aerosols false</code> or <code>--retrieve_aerosols false</code>).</p><h2 id="Non-linearity-and-divergent-steps"><a class="docs-heading-anchor" href="#Non-linearity-and-divergent-steps">Non-linearity and divergent steps</a><a id="Non-linearity-and-divergent-steps-1"></a><a class="docs-heading-anchor-permalink" href="#Non-linearity-and-divergent-steps" title="Permalink"></a></h2><p>At the moment we find that the retrieval behaves more non-linearly when the modeled and measured radiances are very close to each other. So when getting closer to convergence, the retrieval is more likely to produce a divergent step - meaning that the linear prediction for a given state vector update is wrong and the cost function actually increases as a result of that update. We suspect that some of the Jacobian calculations have small errors in them that become more apparent once the retrieval closes in on a state vector that is close to being converged. As a temporary fix, we add a little code snippet that bumps up the Levenberg-Marquard γ parameter when the retrieval gets closer to convergence:</p><pre><code class="language-julia hljs">    chi2 = RE.calculate_chi2(solver)
    all_chi2_small = true
    for (k,v) in chi2
        @info &quot;$(k): χ² = $(v)&quot;
        if (v &gt; 20)
            all_chi2_small = false
        end
    end

    # Manually push gamma to 1000 when we get closer to the solution for better
    # convergence
    if (all_chi2_small)
        solver.gamma = 1000
        @info &quot;Setting LM-γ to $(solver.gamma)&quot;
    end</code></pre><p>So whenever the retrieval gets to a point where the χ^2 is less than some value (here 20), the γ parameter is bumped up to 1000 to make the state vector update steps smaller, which hopefully keeps the updates in the more linear regime.</p><h2 id="FootprintGeometry-not-used"><a class="docs-heading-anchor" href="#FootprintGeometry-not-used">FootprintGeometry not used</a><a id="FootprintGeometry-not-used-1"></a><a class="docs-heading-anchor-permalink" href="#FootprintGeometry-not-used" title="Permalink"></a></h2><h2 id="No-consideration-for-off-pointing-between-spectrometers"><a class="docs-heading-anchor" href="#No-consideration-for-off-pointing-between-spectrometers">No consideration for off-pointing between spectrometers</a><a id="No-consideration-for-off-pointing-between-spectrometers-1"></a><a class="docs-heading-anchor-permalink" href="#No-consideration-for-off-pointing-between-spectrometers" title="Permalink"></a></h2><p>Both OCO-2 and OCO-3 instruments have slight off-pointing between the three spectrometers, meaning that the locations on Earth that each band &quot;sees&quot; is slightly different. While of not much concern regarding smooth geo-physical variables like CO<span>$_2$</span> concentrations or aerosol abundance, there could be significant impact due to the varying surface pressure (or total oxygen column) in rough terrain. We do not account for this off-pointing between spectrometers yet.</p><h2 id="Surface-pressure-Jacobian"><a class="docs-heading-anchor" href="#Surface-pressure-Jacobian">Surface pressure Jacobian</a><a id="Surface-pressure-Jacobian-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-pressure-Jacobian" title="Permalink"></a></h2><h2 id="BRDF-parameters"><a class="docs-heading-anchor" href="#BRDF-parameters">BRDF parameters</a><a id="BRDF-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#BRDF-parameters" title="Permalink"></a></h2><h2 id="No-spectral-dependence-of-scattering-phase-function"><a class="docs-heading-anchor" href="#No-spectral-dependence-of-scattering-phase-function">No spectral dependence of scattering phase function</a><a id="No-spectral-dependence-of-scattering-phase-function-1"></a><a class="docs-heading-anchor-permalink" href="#No-spectral-dependence-of-scattering-phase-function" title="Permalink"></a></h2><p>At the moment, the computation of the scattering phase function expansion coefficients is only done once per spectral window. This means that the overall scattering properties are calculated only once and then re-used for the entire spectral window. At the moment, this is done for performance reasons - the way the coefficients are calculated inside the spectral loop (inside of <code>RT_XRTM.jl</code>) is not optimal and performing the calculation for every spectral point would increase the run-time of retrievals significantly. This will be re-visited. Note, however, that this is an issue related to <code>RetrievalToolbox</code>, rather than our ACOS implementation.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../important/">« Important</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 11 December 2025 10:16">Thursday 11 December 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
